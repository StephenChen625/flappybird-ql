<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Flappy Bird Q-learning</title>
    <style>
        canvas {
            margin-top: 15px;
            border: 4px solid #555;
            padding: 5px;
            border-radius: 10px;
            background-color: #111;
        }
        
        #qtable-canvas {
            margin-top: 20px;
            border: 2px solid #333;
            background-color: white;
            display: none;
        }
        
        .qtable-controls {
            margin: 10px 0;
        }
        
        .params-panel {
            margin: 15px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            display: none;
        }
        
        .param-row {
            margin: 8px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .param-label {
            flex: 1;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .param-slider {
            flex: 2;
            margin: 0 10px;
        }
        
        .param-input {
            flex: 0.8;
            text-align: center;
            font-family: monospace;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            margin-left: 5px;
        }
        
        .legend {
            margin: 10px 0;
            font-size: 12px;
        }
        
        .legend-item {
            display: inline-block;
            margin: 0 10px;
        }
        
        .legend-color {
            display: inline-block;
            width: 15px;
            height: 15px;
            border: 1px solid #333;
            margin-right: 5px;
            vertical-align: middle;
        }
        
        .main-title {
            margin: 20px 0;
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }
        
        footer {
            margin-top: 40px;
            width: 100%;
            text-align: center;
            font-size: 14px;
            color: #666;
            padding: 20px 0;
            border-top: 1px solid #eee;
        }
    </style>
    <link href="https://cdn.bootcss.com/semantic-ui/2.2.10/semantic.min.css" rel="stylesheet">
</head>

<body>
    <center>
        <h1 class="main-title">Flappy Bird Q-learning å¯è§†åŒ–æ¼”ç¤º</h1>
        
        <canvas id="cvs" width="288" height="512"></canvas>
        <br>

        <table id="panel" class="ui very basic collapsing table" style="display: none;">
            <tbody>
                <tr>
                    <td>Max Score</td>
                    <td> <span id="mscore-span">0</span></td>
                </tr>
                <tr>
                    <td>Average Score</td>
                    <td> <span id="ascore-span">0</span></td>
                </tr>
                <tr>
                    <td>Round</td>
                    <td> <span id="round-span">0</span></td>
                </tr>
                <tr>
                    <td>Number of Q-learning States</td>
                    <td> <span id="qstate-span">0</span></td>
                </tr>
                <tr>
                    <td>Current Learning Rate (Î±)</td>
                    <td> <span id="current-alpha">0.60</span></td>
                </tr>
                <tr>
                    <td>Current Exploration Rate (Îµ)</td>
                    <td> <span id="current-epsilon">0.00</span></td>
                </tr>
            </tbody>
        </table>

        <button id="ql-btn" class="ui basic button">Enable Q-learning</button>
        <div class="ui basic icon buttons">
            <button id="dec-fps-btn" class="ui button"><i class="backward icon"></i></button>
            <button id="rst-fps-btn" class="ui button"><i class="undo icon"></i></button>
            <button id="panel-btn" class="ui button"><i class="bar chart icon"></i></button>
            <button id="inc-fps-btn" class="ui button"><i class="forward icon"></i></button>
        </div>
        
        <div class="qtable-controls">
            <button id="qtable-btn" class="ui basic button">Show Q-table Visualization</button>
            <button id="params-btn" class="ui basic button">è°ƒæ•´å­¦ä¹ å‚æ•°</button>
        </div>
        
        <div id="params-panel" class="params-panel">
            <h4 style="margin-top: 0;">Q-learning å‚æ•°è°ƒæ•´</h4>
            
            <div class="param-row">
                <span class="param-label">å­¦ä¹ ç‡ (Î±)</span>
                <input type="range" class="param-slider" id="alpha-slider" min="0.05" max="0.8" step="0.05" value="0.4">
                <input type="number" class="param-input" id="alpha-input" min="0.05" max="0.8" step="0.05" value="0.4">
            </div>
            
            <div class="param-row">
                <span class="param-label">æ¢ç´¢ç‡ (Îµ)</span>
                <input type="range" class="param-slider" id="epsilon-slider" min="0" max="0.2" step="0.01" value="0.05">
                <input type="number" class="param-input" id="epsilon-input" min="0" max="0.2" step="0.01" value="0.05">
            </div>
            
            <div class="param-row">
                <span class="param-label">æ­»äº¡æƒ©ç½š</span>
                <input type="range" class="param-slider" id="deadreward-slider" min="-150" max="-5" step="1" value="-30">
                <input type="number" class="param-input" id="deadreward-input" min="-150" max="-5" step="1" value="-30">
            </div>
            
            <div class="param-row">
                <span class="param-label">æŠ˜æ‰£å› å­ (Î³)</span>
                <input type="range" class="param-slider" id="gamma-slider" min="0.5" max="0.99" step="0.01" value="0.8">
                <input type="number" class="param-input" id="gamma-input" min="0.5" max="0.99" step="0.01" value="0.8">
            </div>
            
            <div style="margin-top: 15px; text-align: center;">
                <button id="reset-params-btn" class="ui basic button">æ¢å¤é»˜è®¤å€¼</button>
                <button id="apply-params-btn" class="ui primary button">åº”ç”¨è®¾ç½®</button>
            </div>
            
            <div style="margin-top: 15px; font-size: 11px; color: #666; line-height: 1.4;">
                <strong>å‚æ•°è¯´æ˜ï¼š</strong><br>
                â€¢ <strong>å­¦ä¹ ç‡</strong>ï¼šæ§åˆ¶å­¦ä¹ é€Ÿåº¦ï¼Œ0.3-0.5å­¦å¾—å¿«ï¼Œ0.1-0.2æ›´ç¨³å®š<br>
                â€¢ <strong>æ¢ç´¢ç‡</strong>ï¼šéšæœºå°è¯•çš„æ¦‚ç‡ï¼Œ0.05-0.1å¯é˜²æ­¢é™·å…¥å±€éƒ¨æœ€ä¼˜<br>
                â€¢ <strong>æ­»äº¡æƒ©ç½š</strong>ï¼šæ’å‡»çš„è´Ÿé¢å¥–åŠ±ï¼Œ-20åˆ°-50ä¹‹é—´æ¯”è¾ƒåˆé€‚<br>
                â€¢ <strong>æŠ˜æ‰£å› å­</strong>ï¼šæœªæ¥å¥–åŠ±çš„é‡è¦æ€§ï¼Œé€šå¸¸ä¿æŒ0.8-0.9<br>
                <strong>å¿«é€Ÿå­¦ä¹ </strong>ï¼šÎ±=0.5, æ­»äº¡æƒ©ç½š=-50 | <strong>ç¨³å®šå­¦ä¹ </strong>ï¼šÎ±=0.2, æ­»äº¡æƒ©ç½š=-20
            </div>
        </div>
        
        <canvas id="qtable-canvas" width="800" height="500"></canvas>
        
        <div id="qtable-legend" class="legend" style="display: none;">
            <div class="legend-item">
                <span class="legend-color" style="background-color: #0000cc;"></span>
                <span>å¼ºçƒˆå»ºè®®ä¸è·³è·ƒ (Don't Jump)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #a0a0a0;"></span>
                <span>è·³ä¸è·³éƒ½å·®ä¸å¤š (Neutral)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #cc0000;"></span>
                <span>å¼ºçƒˆå»ºè®®è·³è·ƒ (Jump!)</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background-color: #ffffff; border: 1px solid #333;"></span>
                <span>æœªæ¢ç´¢åŒºåŸŸ (Unexplored)</span>
            </div>
            <div class="legend-item">
                <span style="font-weight: bold;">ğŸ¦</span>
                <span>å°é¸Ÿä½ç½® (Bird Position)</span>
            </div>
        </div>

        <br>

    </center>

    <footer>
        Â© 2025 å­™ç»´åˆšæ•™è‚²ç ”ç©¶é™¢-é™ˆç¡•è€å¸ˆ ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
    </footer>

    <script src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
    <script src="res/js/core.js"></script>

    <script>
        var qlBtn = document.getElementById("ql-btn");
        $("#ql-btn").click(function () {
            updateQL.enabled = !updateQL.enabled;
            if (updateQL.enabled) {
                qlBtn.innerText = "Disable Q-learning";
            } else {
                qlBtn.innerText = "Enable Q-learning";
            }
        });

        $("#inc-fps-btn").click(function () {
            gameLoop.timeScale = Math.min(gameLoop.timeScale * 1.2, 6);
        });

        $("#dec-fps-btn").click(function () {
            gameLoop.timeScale = Math.max(gameLoop.timeScale * 0.833, 1 / 6);
        });

        $("#rst-fps-btn").click(function () {
            gameLoop.timeScale = 1;
        });

        var panel = $("#panel");
        $("#panel-btn").click(function () {
            panel.toggle();
        });

        // Q-table visualization controls
        var qtableCanvas = $("#qtable-canvas");
        var qtableLegend = $("#qtable-legend");
        var qtableBtn = $("#qtable-btn");
        var showQTable = false;

        $("#qtable-btn").click(function () {
            showQTable = !showQTable;
            if (showQTable) {
                qtableCanvas.show();
                qtableLegend.show();
                qtableBtn.text("Hide Q-table Visualization");
            } else {
                qtableCanvas.hide();
                qtableLegend.hide();
                qtableBtn.text("Show Q-table Visualization");
            }
        });

        // Parameters control panel
        var paramsPanel = $("#params-panel");
        var paramsBtn = $("#params-btn");
        var showParams = false;

        $("#params-btn").click(function () {
            showParams = !showParams;
            if (showParams) {
                paramsPanel.show();
                paramsBtn.text("éšè—å‚æ•°è®¾ç½®");
            } else {
                paramsPanel.hide();
                paramsBtn.text("è°ƒæ•´å­¦ä¹ å‚æ•°");
            }
        });

        // Parameter sliders and inputs - bidirectional sync
        $("#alpha-slider").on("input", function() {
            $("#alpha-input").val(parseFloat(this.value).toFixed(2));
        });
        
        $("#alpha-input").on("input", function() {
            var val = Math.max(0.05, Math.min(0.8, parseFloat(this.value)));
            this.value = val.toFixed(2);
            $("#alpha-slider").val(val);
        });

        $("#epsilon-slider").on("input", function() {
            $("#epsilon-input").val(parseFloat(this.value).toFixed(2));
        });
        
        $("#epsilon-input").on("input", function() {
            var val = Math.max(0, Math.min(0.2, parseFloat(this.value)));
            this.value = val.toFixed(2);
            $("#epsilon-slider").val(val);
        });

        $("#deadreward-slider").on("input", function() {
            $("#deadreward-input").val(parseInt(this.value));
        });
        
        $("#deadreward-input").on("input", function() {
            var val = Math.max(-150, Math.min(-5, parseInt(this.value)));
            this.value = val;
            $("#deadreward-slider").val(val);
        });

        $("#gamma-slider").on("input", function() {
            $("#gamma-input").val(parseFloat(this.value).toFixed(2));
        });
        
        $("#gamma-input").on("input", function() {
            var val = Math.max(0.5, Math.min(0.99, parseFloat(this.value)));
            this.value = val.toFixed(2);
            $("#gamma-slider").val(val);
        });

        // Apply parameters to core.js variables
        $("#apply-params-btn").click(function() {
            // ä»è¾“å…¥æ¡†è¯»å–å€¼å¹¶æ›´æ–°core.jsä¸­çš„å…¨å±€å˜é‡
            window.qlAlpha = parseFloat($("#alpha-input").val());
            window.qlEpsilon = parseFloat($("#epsilon-input").val());
            window.qlDeadReward = parseInt($("#deadreward-input").val());
            window.qlGamma = parseFloat($("#gamma-input").val());
            
            // å¦‚æœcore.jsæœ‰è¿™äº›å˜é‡ï¼Œç›´æ¥æ›´æ–°å®ƒä»¬
            if (typeof qlAlpha !== 'undefined') qlAlpha = window.qlAlpha;
            if (typeof qlEpsilon !== 'undefined') qlEpsilon = window.qlEpsilon;
            if (typeof qlDeadReward !== 'undefined') qlDeadReward = window.qlDeadReward;
            if (typeof qlGamma !== 'undefined') qlGamma = window.qlGamma;
            
            alert("å‚æ•°å·²åº”ç”¨ï¼\nå­¦ä¹ ç‡: " + window.qlAlpha + 
                  "\næ¢ç´¢ç‡: " + window.qlEpsilon + 
                  "\næ­»äº¡æƒ©ç½š: " + window.qlDeadReward + 
                  "\næŠ˜æ‰£å› å­: " + window.qlGamma);
        });

        // Reset to optimized default values (faster learning)
        $("#reset-params-btn").click(function() {
            $("#alpha-slider").val(0.4).trigger("input");
            $("#epsilon-slider").val(0.05).trigger("input");
            $("#deadreward-slider").val(-30).trigger("input");
            $("#gamma-slider").val(0.8).trigger("input");
        });

        // Initialize with balanced default parameters on page load
        $(document).ready(function() {
            // è‡ªåŠ¨åº”ç”¨å¹³è¡¡çš„é»˜è®¤å‚æ•°ï¼ˆå­¦ä¹ é€Ÿåº¦é€‚ä¸­ï¼‰
            setTimeout(function() {
                $("#apply-params-btn").click();
            }, 1000);
        });

        var fpsSpan = $("#fps-span");
        var roundSpan = $("#round-span");
        var maxScoreSpan = $("#mscore-span");
        var averageScoreSpan = $("#ascore-span");
        var qlStateSpan = $("#qstate-span");

        var round = 0;
        var maxScore = 0;
        var averageScore = 0;
        var qlState = 0;

        gameLoop.eachFrame(function (gameState) {
            // æ›´æ–°ç»Ÿè®¡é¢æ¿ï¼ˆåªæœ‰åœ¨å¯è§æ—¶ï¼‰
            if (panel.is(":visible")) {
                var newRound = gameState.round;
                if (round !== newRound) {
                    round = newRound;
                    roundSpan.text(round);
                }

                var newMaxScore = gameState.maxScore;
                if (maxScore !== newMaxScore) {
                    maxScore = newMaxScore;
                    maxScoreSpan.text(maxScore);
                }

                var newAverageScore = (round == 0 ? 0 : gameState.totalScore / round).toFixed(3);
                if (averageScore !== newAverageScore) {
                    averageScore = newAverageScore;
                    averageScoreSpan.text(averageScore);
                }

                var newQLState = updateQL.Q ? Object.keys(updateQL.Q).length : 0;
                if (qlState !== newQLState) {
                    qlState = newQLState;
                    qlStateSpan.text(qlState);
                }

                // Update current parameter display
                $("#current-alpha").text((typeof qlAlpha !== 'undefined' ? qlAlpha : 0.6).toFixed(2));
                $("#current-epsilon").text((typeof qlEpsilon !== 'undefined' ? qlEpsilon : 0).toFixed(2));
            }

            // Update Q-table visualization if enabled (ç‹¬ç«‹äºç»Ÿè®¡é¢æ¿)
            if (showQTable) {
                renderQTableVisualization();
            }
        });

        // Q-table visualization function
        function renderQTableVisualization() {
            var canvas = document.getElementById("qtable-canvas");
            var ctx = canvas.getContext("2d");
            
            // Clear canvas
            ctx.fillStyle = "#f8f8f8";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (!updateQL.Q || Object.keys(updateQL.Q).length === 0) {
                // Draw empty grid with bird position
                drawBirdAndAxes(ctx, canvas);
                
                // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                ctx.fillStyle = "black";
                ctx.font = "16px Arial";
                ctx.fillText("ç­‰å¾…Q-learningæ•°æ®...", canvas.width/2 - 80, 50);
                ctx.font = "12px Arial";
                ctx.fillText("è¯·å¯ç”¨Q-learningå¹¶è®©AIè®­ç»ƒä¸€æ®µæ—¶é—´", canvas.width/2 - 120, 70);
                return;
            }
            
            // Define grid parameters - æ›´ç²¾ç»†çš„ç½‘æ ¼
            var gridWidth = 80;   // æ°´å¹³æ ¼å­æ•°ï¼ˆç®¡é“ä½ç½®ï¼‰
            var gridHeight = 50;  // å‚ç›´æ ¼å­æ•°ï¼ˆå‚ç›´è·ç¦»ï¼‰
            var cellWidth = canvas.width / gridWidth;
            var cellHeight = canvas.height / gridHeight;
            
            // æ‰¾åˆ°çŠ¶æ€ç©ºé—´çš„èŒƒå›´æ¥ä¼˜åŒ–æ˜ å°„
            var xStates = [], yStates = [];
            Object.keys(updateQL.Q).forEach(function(state) {
                var parts = state.split(',');
                xStates.push(parseInt(parts[0]));
                yStates.push(parseInt(parts[1]));
            });
            
            // ä½¿ç”¨å…¼å®¹çš„æ–¹å¼è®¡ç®—æœ€å€¼
            var xMin = xStates.length > 0 ? Math.min.apply(Math, xStates) - 2 : -10;
            var xMax = xStates.length > 0 ? Math.max.apply(Math, xStates) + 2 : 10;
            var yMin = yStates.length > 0 ? Math.min.apply(Math, yStates) - 2 : -10;
            var yMax = yStates.length > 0 ? Math.max.apply(Math, yStates) + 2 : 10;
            
            // Process each state in Q-table
            Object.keys(updateQL.Q).forEach(function(stateStr) {
                var stateParts = stateStr.split(',');
                var xState = parseInt(stateParts[0]);  // ç®¡é“ä½ç½®çŠ¶æ€
                var yState = parseInt(stateParts[1]);  // å‚ç›´è·ç¦»çŠ¶æ€
                
                // ä¿®å¤æ–¹å‘æ˜ å°„ï¼šå°é¸Ÿä¸‹è½æ—¶ï¼Œè‰²å—å‘ä¸Šç§»åŠ¨
                var gridX = Math.min(Math.max(xState + 25, 0), gridWidth - 1);
                var gridY = Math.min(Math.max(yState + 25, 0), gridHeight - 1);  // æ­£å‘æ˜ å°„ï¼šyStateå‡å°‘æ—¶gridYå‡å°‘ï¼ˆå‘ä¸Šï¼‰
                
                // è®¡ç®—å†³ç­–å€¾å‘ï¼šQ(jump) - Q(stay)
                var jumpQ = updateQL.Q[stateStr][1];    // è·³è·ƒçš„Qå€¼
                var stayQ = updateQL.Q[stateStr][0];    // ä¸è·³è·ƒçš„Qå€¼
                var decisionValue = jumpQ - stayQ;      // æ­£å€¼=åº”è¯¥è·³è·ƒï¼Œè´Ÿå€¼=ä¸åº”è¯¥è·³è·ƒ
                
                // æ ¹æ®å†³ç­–å€¾å‘ç¡®å®šé¢œè‰²
                var color = getDecisionColor(decisionValue);
                
                // Draw cell
                ctx.fillStyle = color;
                ctx.fillRect(
                    gridX * cellWidth, 
                    gridY * cellHeight, 
                    cellWidth, 
                    cellHeight
                );
                
                // Draw subtle border
                ctx.strokeStyle = "#ddd";
                ctx.lineWidth = 0.3;
                ctx.strokeRect(
                    gridX * cellWidth, 
                    gridY * cellHeight, 
                    cellWidth, 
                    cellHeight
                );
            });
            
            // ç»˜åˆ¶å°é¸Ÿå’Œåæ ‡è½´
            drawBirdAndAxes(ctx, canvas);
            
            // æ˜¾ç¤ºçŠ¶æ€æ•°é‡ä¿¡æ¯
            ctx.fillStyle = "black";
            ctx.font = "12px Arial";
            ctx.fillText("Qè¡¨çŠ¶æ€æ•°: " + Object.keys(updateQL.Q).length, 10, 20);
        }
        
        function drawBirdAndAxes(ctx, canvas) {
            var gridWidth = 80;
            var gridHeight = 50;
            var cellWidth = canvas.width / gridWidth;
            var cellHeight = canvas.height / gridHeight;
            
            // å°é¸Ÿçš„ä½ç½®ï¼ˆç½‘æ ¼åæ ‡ï¼‰- å¯¹åº”æ˜ å°„é€»è¾‘ä¸­çš„åŸºå‡†ç‚¹
            var birdGridX = 25;  // å¯¹åº” xState=0 çš„ä½ç½®
            var birdGridY = 25;  // å¯¹åº” yState=0 çš„ä½ç½®
            var birdX = birdGridX * cellWidth + cellWidth/2;
            var birdY = birdGridY * cellHeight + cellHeight/2;
            
            // ç”»å°é¸Ÿ
            ctx.fillStyle = "#FFD700";
            ctx.strokeStyle = "#FF8C00";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(birdX, birdY, 8, 0, 2 * Math.PI);
            ctx.fill();
            ctx.stroke();
            
            // ç”»å°é¸Ÿçš„çœ¼ç›
            ctx.fillStyle = "black";
            ctx.beginPath();
            ctx.arc(birdX + 3, birdY - 2, 2, 0, 2 * Math.PI);
            ctx.fill();
            
            // ç”»å‚è€ƒçº¿ï¼ˆåå­—çº¿ï¼‰
            ctx.strokeStyle = "#666";
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            
            // å‚ç›´å‚è€ƒçº¿
            ctx.beginPath();
            ctx.moveTo(birdX, 0);
            ctx.lineTo(birdX, canvas.height);
            ctx.stroke();
            
            // æ°´å¹³å‚è€ƒçº¿
            ctx.beginPath();
            ctx.moveTo(0, birdY);
            ctx.lineTo(canvas.width, birdY);
            ctx.stroke();
            
            ctx.setLineDash([]);
            
            // åæ ‡è½´æ ‡ç­¾
            ctx.fillStyle = "black";
            ctx.font = "bold 14px Arial";
            ctx.fillText("ğŸ¦ Bird", birdX - 20, birdY - 15);
            
            ctx.font = "12px Arial";
            ctx.fillText("ç®¡é“æ°´å¹³è·ç¦» â†’", canvas.width - 120, canvas.height - 10);
            
            ctx.save();
            ctx.translate(15, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText("ç®¡é“ç›¸å¯¹å°é¸Ÿä½ç½® â†‘", 0, 0);
            ctx.restore();
            
            // åœ¨ä¸‹æ–¹ä¹ŸåŠ ä¸€ä¸ªæ ‡ç­¾
            ctx.fillText("ç®¡é“ç›¸å¯¹æ›´ä¸‹æ–¹", 15, canvas.height - 30);
            
            // æ·»åŠ è¯´æ˜æ–‡å­—
            ctx.font = "10px Arial";
            ctx.fillStyle = "#666";
            ctx.fillText("å°é¸Ÿä¸‹è½æ—¶ï¼Œè‰²å—å‘ä¸Šç§»åŠ¨", canvas.width - 180, 20);
            ctx.fillText("è¡¨ç¤ºç®¡é“ç›¸å¯¹ä½ç½®ä¸Šå‡", canvas.width - 160, 35);
            ctx.fillText("æ¨ªè½´ï¼šç®¡é“æ°´å¹³è·ç¦»", canvas.width - 140, 50);
        }
        
        function getDecisionColor(decisionValue) {
            // decisionValue = Q(jump) - Q(stay)
            // æ­£å€¼ = å»ºè®®è·³è·ƒ = çº¢è‰²
            // è´Ÿå€¼ = å»ºè®®ä¸è·³è·ƒ = è“è‰²
            // æ¥è¿‘0 = æ— æ‰€è°“ = ç°è‰²
            
            var threshold = 2; // åˆ¤æ–­é˜ˆå€¼
            
            if (decisionValue > threshold) {
                // å¼ºçƒˆå»ºè®®è·³è·ƒ - çº¯çº¢è‰²
                var intensity = Math.min(255, Math.max(150, Math.abs(decisionValue) * 10));
                return `rgb(${intensity}, 0, 0)`;
            } else if (decisionValue < -threshold) {
                // å¼ºçƒˆå»ºè®®ä¸è·³è·ƒ - çº¯è“è‰²
                var intensity = Math.min(255, Math.max(150, Math.abs(decisionValue) * 10));
                return `rgb(0, 0, ${intensity})`;
            } else {
                // ä¸­æ€§å†³ç­– - ç°è‰²
                return `rgb(160, 160, 160)`;
            }
        }

        gameLoop.start();
    </script>
</body>

</html>
